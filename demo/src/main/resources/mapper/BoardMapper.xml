<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.fullstack.finalproject.board.mapper.BoardMapper">

	<resultMap id="boardResultMap" type="com.fullstack.finalproject.board.dto.BoardDto">
		<id property="id" column="id" />
		<result property="authorId" column="author_id" />
		<result property="category" column="category" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="writeday" column="writeday" />
		<result property="views" column="views" />
		<result property="like" column="like" />
		<result property="replCnt" column="repl_cnt" />
	</resultMap>

	<select id="findAll" resultMap="boardResultMap">
		select title, writeday from board;
	</select>

	<select id="findById" resultMap="boardResultMap">
		select * from board;
	</select>
	<select id="findByIdReview" resultMap="boardResultMap">
		select * from board as b
		join reviewboard as v on v.board_no=#{board_no} and b.board_no=#{board_no}
		join member as m on b.author_no=m.member_no
	</select>
	<select id="findByIdRepls" resultMap="boardResultMap">
		select * from boardrepls as br
		join board as b on br.board_no=#{board_no} and b.board_no=#{board_no}
		order by boardrepl_group asc
	</select>
	

	<insert id="insert" useGeneratedKeys="true" keyProperty="board_no">
		INSERT INTO board(board_title, board_content, board_category, board_writeday, author_no) 
		VALUES (#{board_title}, #{board_content}, #{board_category}, now(), #{author_no})
	</insert>
	<insert id="recruitInsert" useGeneratedKeys="true" keyProperty="board_no">
		INSERT INTO recruitboard(cboard_tags, recruit_done, trip_start, trip_end, board_no) 
		VALUES (#{cboard_tags}, #{recruit_done}, #{trip_start}, #{trip_end},
		(select board_no from board order by board_no desc limit 1))
	</insert>
	<insert id="reviewInsert" useGeneratedKeys="true" keyProperty="board_no">
		INSERT INTO reviewboard(board_no) 
		VALUES ((select board_no from board order by board_no desc limit 1))
	</insert>
	<insert id="insertRepl" useGeneratedKeys="true" keyProperty="board_no">
		INSERT INTO boardrepls(boardrepl_content, replauthor_no, replauthor_nickname, boardrepl_group, boardrepl_repl_seq, boardrepl_writeday, board_no) 
		VALUES (#{boardrepl_content}, #{replauthor_no}, #{replauthor_nickname}, #{boardrepl_group}, #{boardrepl_repl_seq}, now(), #{board_no})
	</insert>
	

	<update id="update">
		UPDATE board SET board_title=#{board_title}, board_content=#{board_content} WHERE board_no=#{board_no}
	</update>
	<update id="recruitUpdate">
		UPDATE recruitboard SET 
		recruit_done = #{recruit_done},
    	trip_start = #{trip_start},
    	trip_end = #{trip_end},
    	cboard_tags = #{cboard_tags}
		WHERE cboard_no=#{cboard_no}
	</update>
	

	<delete id="delete">
		DELETE FROM board WHERE board_no=#{board_no}
	</delete>
</mapper>